---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro'; // V√°≈° hlavn√≠ layout

const allDocs = await getCollection('docs');
const languages = ['cs', 'en', 'de', 'es'];

// Seskupen√≠ dokument≈Ø podle jejich ID (cesty bez jazykov√©ho prefixu)
const docsMap = {};

allDocs.forEach(entry => {
  const [lang, ...pathParts] = entry.id.split('/');
  const baseId = pathParts.join('/');
  
  if (!docsMap[baseId]) {
    docsMap[baseId] = { id: baseId, locales: {} };
  }
  
  docsMap[baseId].locales[lang] = {
    hash: entry.data.content_hash || entry.data.source_hash,
    status: entry.data.translation_status,
    from: entry.data.translated_from
  };
});

const rows = Object.values(docsMap);
---

<Layout title="Localization Dashboard">
  <main class="p-8">
    <h1 class="text-2xl font-bold mb-6">Localization Status (2026)</h1>
    <table class="w-full border-collapse">
      <thead>
        <tr class="bg-gray-100">
          <th class="border p-2">Document ID</th>
          {languages.map(lang => <th class="border p-2">{lang.toUpperCase()}</th>)}
        </tr>
      </thead>
      <tbody>
        {rows.map(row => (
          <tr>
            <td class="border p-2 font-mono text-sm">{row.id}</td>
            {languages.map(lang => {
              const data = row.locales[lang];
              const isOriginal = data?.status === 'original';
              const exists = !!data;
              
              return (
                <td class={`border p-2 text-center ${!exists ? 'bg-red-100' : ''}`}>
                  {exists ? (
                    <span title={`Hash: ${data.hash}`}>
                      {isOriginal ? '‚úÖ Origin' : `üåê from ${data.from}`}
                    </span>
                  ) : (
                    <span class="text-red-600 font-bold">MISSING</span>
                  )}
                </td>
              );
            })}
          </tr>
        ))}
      </tbody>
    </table>
  </main>
</Layout>
