<div id="3d-graph" style="position:fixed; inset:0"></div>

<script is:inline src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script is:inline src="https://unpkg.com/three@0.160.0/examples/js/postprocessing/EffectComposer.js"></script>
<script is:inline src="https://unpkg.com/three@0.160.0/examples/js/postprocessing/RenderPass.js"></script>
<script is:inline src="https://unpkg.com/three@0.160.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
<script is:inline src="https://unpkg.com/3d-force-graph"></script>

<script is:inline>
const gData = {
  nodes: [
    { id: 'Animal', color: '#ff6666' },
    { id: 'Mammal', color: '#66ff66' },
    { id: 'Reptile', color: '#6666ff' },
    { id: 'Canine', color: '#87ceeb' },
    { id: 'Feline', color: '#ffa500' },
    { id: 'Dog', color: '#87ceeb' },
    { id: 'Cat', color: '#ffa500' },
    { id: 'Lizard', color: '#6666ff' }
  ],
  links: [
    { source: 'Mammal', target: 'Animal' },
    { source: 'Reptile', target: 'Animal' },
    { source: 'Canine', target: 'Mammal' },
    { source: 'Feline', target: 'Mammal' },
    { source: 'Dog', target: 'Canine' },
    { source: 'Cat', target: 'Feline' },
    { source: 'Lizard', target: 'Reptile' }
  ]
};

const Graph = ForceGraph3D()(document.getElementById('3d-graph'))
  .graphData(gData)
  .nodeAutoColorBy('id')
  .nodeLabel('id')
  .nodeThreeObject(node => {
    const sprite = new THREE.Sprite(
      new THREE.SpriteMaterial({
        map: makeTextTexture(node.id, '#ffffff'),//node.color),
        transparent: true
      })
    );
    sprite.scale.set(20, 10, 1);
    return sprite;
  })
  .onNodeClick(node => {
    const distance = 80;
    const distRatio = 1 + distance / Math.hypot(node.x, node.y, node.z);

    Graph.cameraPosition(
      { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio },
      node,
      1500
    );
  })
  .linkDirectionalParticles(2)
  .linkDirectionalParticleWidth(1.2);
  const bloomPass = new THREE.UnrealBloomPass(
    new THREE.Vector2(window.innerWidth, window.innerHeight),
    1.2,
    0.8,
    0.0
  );

  Graph.postProcessingComposer().addPass(bloomPass);

Graph.zoomToFit(400);

// ---- text texture ----
function makeTextTexture(text, color) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = 512;
  canvas.height = 256;
/*
  ctx.fillStyle = 'rgba(20,20,20,0.85)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = color;
  ctx.font = '64px sans-serif';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(text, canvas.width / 2, canvas.height / 2);
*/
  ctx.fillStyle = 'rgba(0,0,0,0.0)'; // ŽÁDNÉ pozadí
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = '#ffffff';        // čistě bílý text
  ctx.font = 'bold 72px sans-serif';
  ctx.shadowColor = '#ffffff';
  ctx.shadowBlur = 20;

  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(text, canvas.width / 2, canvas.height / 2);

  return new THREE.CanvasTexture(canvas);
}
</script>