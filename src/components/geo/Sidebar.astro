---
import dayImage from '@/assets/img/globe/earth_day_640x480px.webp';
import nightImage from '@/assets/img/globe/earth_night_640x480px.webp';
import cloudsImage from '@/assets/img/globe/earth_clouds_640x480px.webp';
import type { StarlightRouteData } from '@astrojs/starlight/route-data';
import DefaultSidebar from '@astrojs/starlight/components/Sidebar.astro';
import ToolBar from '@/components/root/ToolBar.astro';
import Icons from '@/components/root/Icon.astro';
import SocialCircle from '@/components/root/SocialCircle.astro';
import { getRelativeLocaleUrl } from 'astro:i18n';

interface Props extends StarlightRouteData {}
const dayImageUrl = `url(${dayImage.src})`;
const nightImageUrl = `url(${nightImage.src})`;
const cloudsImageUrl = `url(${cloudsImage.src})`;
const lang = Astro.currentLocale || 'en';
const landingLink = getRelativeLocaleUrl(lang, '/');
---
<Icons />

<div class="social-circle-wrapper geo-version">
  <div class="circular-menu">
    <SocialCircle>
      <a href={landingLink} aria-label="About page" class="globe-link">
        <div class="profile-img main-img"><div class="clouds"></div></div>
        <div class="profile-img hover-img"><div class="clouds"></div></div>
      </a>
    </SocialCircle>
  </div>
</div>

<ToolBar />

<div class="wrapper">
  <DefaultSidebar {...Astro.props} />
</div>

<style define:vars={{ dayImageUrl, nightImageUrl, cloudsImageUrl }}>
  .geo-version {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 30px 0;
    position: relative;
  }

  /* ZAJIŠTĚNÍ, ŽE GLOBUS PŘEKRYJE OBLIČEJ */
  .globe-link {
    display: block;
    width: 180px;
    height: 180px;
    position: relative;
    z-index: 10; /* Musí být nad obličejem v SocialCircle */
    border-radius: 50%;
  }

  /* SKRYTÍ PŮVODNÍCH OBRÁZKŮ OBLIČEJE, ABY NEPROSVÍTALO NIC POD GLOBUSEM */
  .geo-version :global(.main-img), 
  .geo-version :global(.hover-img) {
    background-size: cover;
  }

  /* STYLOVÁNÍ GLOBUSU */
  .profile-img {
    position: absolute;
    inset: 0;
    width: 180px;
    height: 180px;
    border-radius: 50%;
    overflow: hidden;
    background-color: #000; /* Pozadí pro vesmír */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 60px rgba(79, 172, 254, 0.4);
    animation: pulse 5s ease-in-out infinite;
  }

  .main-img { background-image: var(--current-main-image); z-index: 1; }
  .hover-img { background-image: var(--current-hover-image); z-index: 2; opacity: 0; transition: opacity 0.5s; }
  
  .globe-link:hover .hover-img { opacity: 1; }

  /* LOGIKA TÉMAT PRO GLOBUS */
  :global(:root[data-theme='light']) .geo-version {
    --current-main-image: var(--dayImageUrl);
    --current-hover-image: var(--nightImageUrl);
  }
  :global(:root[data-theme='dark']) .geo-version {
    --current-main-image: var(--nightImageUrl);
    --current-hover-image: var(--dayImageUrl);
  }

  /* TEXTURA ZEMĚ (Aplikuje se na ::after všech .profile-img v tomto souboru) */
  .profile-img::after {
    content: '';
    position: absolute;
    inset: -10%;
    width: 120%;
    height: 120%;
    transform: rotate(23.5deg);
    background-image: inherit; /* Převezme background-image od rodiče (.main-img/.hover-img) */
    background-size: cover;
    background-repeat: repeat-x;
    animation: rotateGlobe 60s linear infinite;
  }

  /* ATMOSFÉRA */
  .profile-img::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 50%;
    z-index: 5;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.1) 0%, transparent 40%, rgba(0,0,0,0.8) 100%);
    pointer-events: none;
  }

  .clouds {
    position: absolute;
    inset: 0;
    z-index: 4;
    background-image: var(--cloudsImageUrl);
    background-size: cover;
    background-repeat: repeat-x;
    mix-blend-mode: screen;
    animation: rotateClouds 45s linear infinite;
    opacity: 0.3;
  }

  @keyframes rotateGlobe {
    from { background-position: 0 0; }
    to { background-position: -400% 0; }
  }
  @keyframes rotateClouds {
    from { background-position: 0 0; }
    to { background-position: -400% 0; }
  }
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.03); }
  }
</style>
