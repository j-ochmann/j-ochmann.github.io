---
import type { StarlightRouteData } from '@astrojs/starlight/route-data';
import Icons from '@/components/icons/icons.astro';
import DefaultSidebar from '@astrojs/starlight/components/Sidebar.astro';
import ToolBar from '@/components/ToolBar.astro';
import SocialCircle from '@/components/SocialCircle.astro';
import mainImage from '@/assets/img/me/20250712_056.jpg?url';
import hoverImage from '@/assets/img/me/20250712_055.jpg?url';
import { getRelativeLocaleUrl } from 'astro:i18n';

interface Props extends StarlightRouteData {}
const lang = Astro.currentLocale || 'en';
const aboutLink = getRelativeLocaleUrl(lang, 'about');
---
<Icons />

<div class="sidebar-layout">
  <!-- 1. DETEKTOR A PROFIL -->
  <div class="profile-container">
    <div class="social-circle-wrapper">
       <!-- Váš kód s profilem -->
       <div class="circular-menu">
          <a href={aboutLink}>
            <img src={mainImage} class="profile-img main-img" />
            <SocialCircle />
          </a>
       </div>
    </div>
  </div>

  <!-- 2. TOOLBAR (Musí být až po profilu!) -->
  <ToolBar /> 

  <!-- 3. OBSAH SIDEBARU -->
  <div class="wrapper">
    <DefaultSidebar {...Astro.props} />
  </div>
</div>

<style is:global> /* is:global zajistí, že ovlivníme i ToolBar pokud je to nutné */
  .sidebar-layout {
    display: flex;
    flex-direction: column;
    position: relative;
  }

  .profile-container {
    position: relative;
    height: auto;
    /* Důležité: Tento kontejner nesmí mít z-index, aby profil "vyčníval" ven */
  }

  .social-circle-wrapper {
    position: relative;
    /* Vyšší než ToolBar, aby ho nahoře překryl */
    z-index: 1100; 
    margin-bottom: 2rem;
    transition: transform 0.2s ease;
  }

  /* TOOLBAR SETUP */
  .toolbar {
    position: fixed !important;
    top: 0;
    z-index: 1000; /* Nižší než profil v klidu */
    /* Sklo */
    backdrop-filter: blur(10px);
    background: rgba(var(--sl-color-bg-sidebar-rgb), 0.8);
  }

  /* KLÍČOVÝ TRIK: CSS Scroll-Driven Animation (2026 standard) */
  @keyframes sink-under {
    0% { z-index: 1100; opacity: 1; }
    1% { z-index: 500; } /* Okamžitý propad pod toolbar po zahájení scrollu */
    100% { z-index: 500; }
  }

  .social-circle-wrapper {
    /* Pokud prohlížeč podporuje (Chrome, Edge, Safari 2025+), 
       profil se propadne pod lištu hned, jak se pohne */
    animation: sink-under linear both;
    animation-timeline: scroll();
    animation-range: 0px 50px;
  }

  /* Fallback pro starší prohlížeče bez JS: 
     Profil prostě odroluje pod lištu díky pořadí v DOMu, 
     pokud mu sebereme ten vysoký z-index. */
</style>
