---
import type { StarlightRouteData } from '@astrojs/starlight/route-data';
import Icons from '@/components/icons/icons.astro';
import DefaultSidebar from '@astrojs/starlight/components/Sidebar.astro';
import ToolBar from '@/components/ToolBar.astro';
import SocialCircle from '@/components/SocialCircle.astro';
import mainImage from '@/assets/img/me/20250712_056.jpg?url';
import hoverImage from '@/assets/img/me/20250712_055.jpg?url';
import { getRelativeLocaleUrl } from 'astro:i18n';

interface Props extends StarlightRouteData {}
const lang = Astro.currentLocale || 'en';
const aboutLink = getRelativeLocaleUrl(lang, 'about');
---
<Icons />

<div class="sidebar-layout">
  <div class="profile-container">
    <div class="social-circle-wrapper">
       <div class="circular-menu">
          <a href={aboutLink} class="profile-link">
            <img src={mainImage} class="profile-img main-img" alt="Profile" />
            <img src={hoverImage} class="profile-img hover-img" alt="Profile Hover" />
          </a>
          <SocialCircle />
       </div>
    </div>
  </div>

  <!-- 2. TOOLBAR (Musí být až po profilu!) -->
  <ToolBar /> 

  <!-- 3. OBSAH SIDEBARU -->
  <div class="wrapper">
    <DefaultSidebar {...Astro.props} />
  </div>
</div>

<style is:global> /* is:global zajistí, že ovlivníme i ToolBar pokud je to nutné */
  .sidebar-layout {
    display: flex;
    flex-direction: column;
    position: relative;
  }

  .profile-container {
    position: relative;
    /* Rezervujeme místo, aby menu pod ním neskákalo */
    min-height: 200px; 
    display: flex;
    justify-content: center;
    /*padding-top: 2rem;*/
  }

  .social-circle-wrapper {
    position: relative;
    z-index: 1100; 
    margin-bottom: 2rem;
    transition: transform 0.2s ease;
    /* CLEAN CSS SCROLL EFFECT */
    animation: sink-under linear both;
    animation-timeline: scroll();
    animation-range: 0px 80px; 
  }

  /* TOOLBAR SETUP */
  .toolbar {
    position: fixed !important;
    top: 0;
    left: 0;
    width: 300px; /* Nebo šířka sidebaru */
    z-index: 1000; /* Nižší než profil v klidu */
    /* Sklo */
    backdrop-filter: blur(8px) saturate(180%);
    -webkit-backdrop-filter: blur(8px) saturate(180%);
    /*background: color-mix(in srgb, var(--sl-color-bg-sidebar), transparent 75%);*/
    border-right: 1px solid color-mix(in srgb, var(--sl-color-hairline), transparent 0%);
  }

/* Oprava mizení profilovky: zajistěte, aby obrázky měly jasný z-index v rámci wrapperu */
.profile-img {
  position: relative;
  display: block;
}

.hover-img {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
}

.social-circle-wrapper:hover .hover-img {
  opacity: 1;
}

@keyframes sink-under {
  0% { z-index: 1100; }
  /* Propadne se dříve, než se dotkne horní hrany toolbaru */
  10% { z-index: 500; } 
  100% { z-index: 500; }
}

.wrapper {
  position: relative;
  z-index: 1;
  margin-top: 1rem;
}

</style>
