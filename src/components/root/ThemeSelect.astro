---
//import { Icon } from '@astrojs/starlight/components';
import { Icon } from 'astro-icon/components';
---

<div class="theme-select-wrapper">
  <button id="theme-toggle" class="theme-toggle-btn" aria-label="Přepnout režim">
    <div class="theme-icon-container icon-sun">
      <Icon name="line-md:sunny-filled-loop" width="24" height="24" />
      <!--<Icon name="line-md:sun-rising-loop" width="24" height="24" />-->
    </div>
    <div class="theme-icon-container icon-moon">
      <Icon name="line-md:moon-filled-loop" width="24" height="24" />
    </div>
  </button>
</div>

<script is:inline>
  function updateThemeToggle() {
    const theme = document.documentElement.getAttribute('data-theme') || 
                  (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    const btn = document.getElementById('theme-toggle');
    if (btn) btn.classList.remove('loading');
  }
  updateThemeToggle();
  const observer = new MutationObserver(updateThemeToggle);
  observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });

  document.getElementById('theme-toggle')?.addEventListener('click', () => {
    const current = document.documentElement.getAttribute('data-theme') || 'dark';
    const next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('starlight-theme', next);
  });
</script>

<style lang="scss">
  @use "@/styles/mixins" as *;
  .theme-select-wrapper {
    position: relative; // Nutné pro fungování z-indexu
    z-index: 1000;  
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .theme-toggle-btn {
    position: relative;
    z-index: 1001;
    background: transparent;
    border: none;
    padding: 0;
    cursor: pointer;
    outline: none;
    appearance: none;
  }
  .theme-icon-container {
    @include icon-glass;
    display: none; /* Defaultně skryto */
    // Resetování SVG pro Starlight ikonu (aby seděla do mixinu)
    :global(svg) {
      width: 22px !important;
      height: 22px !important;
      fill: currentColor;
    }
  }
  :global([data-theme='dark']) .icon-sun {
    display: flex;
  }
  :global([data-theme='light']) .icon-moon {
    display: flex;
  }
  :global([data-theme='auto']) {
    @media (prefers-color-scheme: dark) {
      .icon-sun { display: flex; }
    }
    @media (prefers-color-scheme: light) {
      .icon-moon { display: flex; }
    }
  }
</style>
