---
// Tento kÃ³d bÄ›Å¾Ã­ na serveru pÅ™i buildu
import { getCollection } from 'astro:content';
import astroConfig from '../../astro.config.mjs';

// Starlight config is in the integrations array
const starlightConfig = astroConfig.integrations.find(i => i.name === '@astrojs/starlight');
const languages = starlightConfig ? Object.keys(starlightConfig.locales) : [];
const docsMap: { [key: string]: { id: string; locales: { [key: string]: any } } } = {};

allDocs.forEach(entry => {
  // Starlight ID jsou ve formÃ¡tu 'cs/index' nebo 'en/tutorials/git'
  const parts = entry.id.split('/');
  const lang = parts[0];
  const baseId = parts.slice(1).join('/');
  
  if (!docsMap[baseId]) docsMap[baseId] = { id: baseId, locales: {} };
  
  docsMap[baseId].locales[lang] = {
    status: entry.data.translation_status,
    from: entry.data.translated_from,
    hash: entry.data.content_hash || entry.data.source_hash
  };
});

const rows = Object.values(docsMap);
---

<div class="not-content">
  <table style="width: 100%; border-collapse: collapse; margin-top: 2rem;">
    <thead>
      <tr style="background-color: var(--sl-color-bg-nav); text-align: left;">
        <th style="padding: 0.5rem; border: 1px solid var(--sl-color-hairline-light);">Cesta (ID)</th>
        {languages.map(lang => <th style="padding: 0.5rem; border: 1px solid var(--sl-color-hairline-light);">{lang.toUpperCase()}</th>)}
      </tr>
    </thead>
    <tbody>
      {rows.map(row => (
        <tr>
          <td style="padding: 0.5rem; border: 1px solid var(--sl-color-hairline-light); font-size: 0.8rem;">{row.id}</td>
          {languages.map(lang => {
            const data = row.locales[lang];
            const exists = !!data;
            const isOriginal = data?.status === 'original';
            
            return (
              <td style={{
                padding: '0.5rem',
                border: '1px solid var(--sl-color-hairline-light)',
                textAlign: 'center',
                backgroundColor: !exists ? 'rgba(255, 0, 0, 0.1)' : 'transparent'
              }}>
                {exists ? (
                  <span title={`Hash: ${data.hash}`}>
                    {isOriginal ? 'âœ…' : `ğŸŒ (${data.from})`}
                  </span>
                ) : (
                  <span style="color: var(--sl-color-error);">âŒ</span>
                )}
              </td>
            );
          })}
        </tr>
      ))}
    </tbody>
  </table>
</div>
